<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>The Wedding of {{ data.groom }} & {{ data.bride }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
</head>

<body>
    <div id="cover-page" class="cover-page">
        <div class="cover-overlay"></div>
        <div class="cover-content">
            <h5 class="cover-text">Undangan Pernikahan</h5>
            <h1 class="cover-title">{{ data.groom }} <br>&<br> {{ data.bride }}</h1>
            <p class="cover-text to-guest">Kepada Yth. Bapak/Ibu/Saudara/i</p>
            <h2 class="cover-text"><b>{{ nama_tamu }}</b></h2>
            <p class="cover-text mt-3">Tanpa mengurangi rasa hormat, kami mengundang Anda untuk hadir di acara pernikahan kami.</p>
            <button class="btn btn-gold-cover" onclick="openInvitation()">Buka Undangan</button>
        </div>
    </div>

    <audio id="bg-music" autoplay loop>
        <source src="{{ url_for('static', filename='music/gamelan.mp3') }}" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <button class="music-btn" onclick="toggleMusic()">ðŸŽµ</button>

    <!-- Main content container -->
    <div id="main-content" style="display: none;">
        <section class="hero d-flex align-items-center justify-content-center text-center">
            <div class="overlay"></div>
            <div class="content text-white" data-aos="zoom-in">
                <h3 class="fst-italic">The Wedding of</h3>
                <h1 class="display-3 couple-name">{{ data.groom }} <br>&<br> {{ data.bride }}</h1>
                <p class="lead mt-3">Save the Date</p>
                <div id="countdown" class="countdown"></div>
            </div>
        </section>

        <section class="py-5 text-center" data-aos="zoom-in">
            <h2 class="mb-4 section-title">Menuju Hari Bahagia</h2>
            <div id="timer" class="d-flex justify-content-center flex-wrap gap-3"></div>
        </section>

        <section id="akad" class="container py-5 text-center" data-aos="fade-up">
            <h2 class="section-title">Akad Nikah</h2>
            <p class="mt-3 fw-bold">{{ data.akad_date }}</p>
            <p>{{ data.akad_venue }}</p>
            <a href="https://maps.google.com/?q={{ data.akad_venue | urlencode }}" target="_blank"
                class="btn btn-outline-dark mt-2">Lihat Lokasi</a>
        </section>

        <section id="resepsi" class="container py-5 text-center" data-aos="fade-up">
            <h2 class="section-title">Resepsi</h2>
            <p class="mt-3 fw-bold">{{ data.resepsi_date }}</p>
            <p>{{ data.resepsi_venue }}</p>
            <a href="https://maps.app.goo.gl/sd6aJ7fU7vy39upN9" target="_blank"
                class="btn btn-outline-dark mt-2">Lihat Lokasi</a>
        </section>

        <section class="container py-5">
            <div class="row align-items-center text-center">
                <div class="col-md-5 mb-4" data-aos="fade-right">
                    <img src="{{ url_for('static', filename='img/wanita.jpg') }}"
                        class="img-fluid rounded-circle border-gold shadow">
                    <h4 class="mt-3">{{ data.bride }}</h4>
                    <p class="text-muted">Putri dari {{ data.bride_parents }}</p>
                </div>
                <div class="col-md-2 d-none d-md-block">
                    <h1 class="ampersand">&</h1>
                </div>
                <div class="col-md-5 mb-4" data-aos="fade-left">
                    <img src="{{ url_for('static', filename='img/pria.jpg') }}"
                        class="img-fluid rounded-circle border-gold shadow">
                    <h4 class="mt-3">{{ data.groom }}</h4>
                    <p class="text-muted">Putra dari {{ data.groom_parents }}</p>
                </div>
            </div>
        </section>

        <section class="container py-5 text-center">
            <h2 class="section-title">Galeri</h2>
            <div class="row mt-4">
                {% for img in data.gallery %}
                <div class="col-6 col-md-4 mb-3" data-aos="zoom-in">
                    <img src="{{ url_for('static', filename='img/' ~ img) }}" class="img-fluid rounded shadow gallery-img">
                </div>
                {% endfor %}
            </div>
        </section>

        <section id="rsvp" class="py-5 text-center" data-aos="fade-up">
            <h2 class="section-title">RSVP</h2>
            <p>Please confirm your attendance before,</p>
            <h5 class="fw-bold">Oct 11<sup>th</sup>, 2025</h5>
            <p>Will you attend our wedding?</p>

            <div class="d-flex justify-content-center gap-3">
                <button id="btn-hadir" class="btn btn-rsvp">Hadir</button>
                <button id="btn-tidak-hadir" class="btn btn-rsvp">Tidak Hadir</button>
            </div>
            <div id="rsvp-alert" class="rsvp-alert mt-3" role="alert"></div>
        </section>

        <section id="gift" class="py-5 text-center" data-aos="fade-up">
            <h2 class="section-title">Wedding Gift</h2>
            <p>Doa & restu Anda merupakan hadiah terbaik. Namun, jika ingin memberikan hadiah secara digital:</p>

            {% for account in data.bank_accounts %}
            <div class="gift-box">
                <h5>{{ account.type }}</h5>
                <p>{{ account.number }} (Atas Nama: {{ account.name }})</p>
            </div>
            {% endfor %}
        </section>


        <footer class="text-center py-4 bg-dark text-white small">
            Â© 2025 muhammad Idris Marzuki.
        </footer>
    </div> 

    <!-- RSVP Modal -->
    <div id="rsvp-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h3 id="modal-title">Konfirmasi Kehadiran</h3>
            <form id="rsvp-form" action="/rsvp" method="POST">
                <input type="hidden" id="attendance" name="attendance" value="">
                <label for="guest_name">Nama Lengkap:</label>
                <input type="text" id="guest_name" name="guest_name" required>

                <label for="num_guests">Jumlah Tamu (termasuk Anda):</label>
                <input type="number" id="num_guests" name="num_guests" min="1" value="1" required>

                <label for="message">Pesan / Doa Restu:</label>
                <textarea id="message" name="message" rows="4"></textarea>

                <button type="submit" class="btn btn-gold">Kirim Konfirmasi</button>
            </form>
        </div>
    </div>


    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init({ duration: 1000 });

        const music = document.getElementById("bg-music");
        let playing = false; // Set to false initially as music will play on openInvitation

        function toggleMusic() {
            if (playing) { music.pause(); } else { music.play(); }
            playing = !playing;
            // Update button icon if needed
            const musicBtn = document.querySelector('.music-btn');
            musicBtn.textContent = playing ? 'ðŸ”‡' : 'ðŸŽµ'; // Optional: change icon
        }

        function openInvitation() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.body.style.overflow = 'auto'; // Mengaktifkan scroll
            document.body.classList.add('animated-background'); // Tambahkan kelas background animasi
            
            // Auto-play music if it was allowed
            const playPromise = music.play();
            if (playPromise !== undefined) {
                playPromise.then(_ => {
                    playing = true;
                    const musicBtn = document.querySelector('.music-btn');
                    musicBtn.textContent = 'ðŸ”‡'; // Show mute icon
                }).catch(error => {
                    console.log("Autoplay was prevented.", error);
                    // Autoplay was prevented. Show play icon
                    playing = false;
                    const musicBtn = document.querySelector('.music-btn');
                    musicBtn.textContent = 'ðŸŽµ'; 
                });
            }
        }

        // RSVP Modal Logic
        const rsvpModal = document.getElementById('rsvp-modal');
        const btnHadir = document.getElementById('btn-hadir');
        const btnTidakHadir = document.getElementById('btn-tidak-hadir');
        const attendanceInput = document.getElementById('attendance');
        const modalTitle = document.getElementById('modal-title');
        const rsvpForm = document.getElementById('rsvp-form');
        const rsvpAlert = document.getElementById('rsvp-alert');

        btnHadir.onclick = function() {
            attendanceInput.value = 'hadir';
            modalTitle.textContent = 'Konfirmasi Kehadiran (Hadir)';
            rsvpModal.style.display = 'flex';
            btnHadir.classList.add('active');
            btnTidakHadir.classList.remove('active');
        }

        btnTidakHadir.onclick = function() {
            attendanceInput.value = 'tidak hadir';
            modalTitle.textContent = 'Konfirmasi Kehadiran (Tidak Hadir)';
            rsvpModal.style.display = 'flex';
            btnTidakHadir.classList.add('active');
            btnHadir.classList.remove('active');
        }

        function closeModal() {
            rsvpModal.style.display = 'none';
        }

        // Close modal when clicking outside of it
        window.onclick = function(event) {
            if (event.target == rsvpModal) {
                closeModal();
            }
        }

        // Handle form submission
        rsvpForm.onsubmit = async function(event) {
            event.preventDefault(); // Prevent default form submission

            const formData = new FormData(rsvpForm);
            const data = Object.fromEntries(formData.entries());
            
            try {
                const response = await fetch('/rsvp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                rsvpAlert.style.display = 'block';
                if (result.success) {
                    rsvpAlert.classList.remove('error');
                    rsvpAlert.classList.add('success');
                    rsvpAlert.textContent = result.message;
                    rsvpForm.reset(); // Clear form
                    closeModal(); // Close modal on success
                } else {
                    rsvpAlert.classList.remove('success');
                    rsvpAlert.classList.add('error');
                    rsvpAlert.textContent = result.message;
                }
            } catch (error) {
                console.error('Error submitting RSVP:', error);
                rsvpAlert.style.display = 'block';
                rsvpAlert.classList.remove('success');
                rsvpAlert.classList.add('error');
                rsvpAlert.textContent = 'Terjadi kesalahan saat mengirim konfirmasi. Silakan coba lagi.';
            }

            // Hide alert after a few seconds
            setTimeout(() => {
                rsvpAlert.style.display = 'none';
            }, 5000);
        }
    </script>
    <script src="{{ url_for('static', filename='js/countdown.js') }}"></script>
    <script>
  // Tanggal Acara Akad
  const eventDate = new Date("Oct 12, 2025 09:00:00").getTime();

  const timer = setInterval(function() {
    const now = new Date().getTime();
    const distance = eventDate - now;

    if (distance < 0) {
      clearInterval(timer);
      document.getElementById("timer").innerHTML = 
        "<div class='time-box finished'>Acara Sedang Berlangsung</div>";
      return;
    }

    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

    document.getElementById("timer").innerHTML = `
      <div class="time-box"><span>${days}</span><small>Hari</small></div>
      <div class="time-box"><span>${hours}</span><small>Jam</small></div>
      <div class="time-box"><span>${minutes}</span><small>Menit</small></div>
      <div class="time-box"><span>${seconds}</span><small>Detik</small></div>
    `;
  }, 1000);
</script>

</body>

</html>